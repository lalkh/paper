from scapy.all import *
import dpkt
import pandas as pd
import socket
import time
import datetime
#pcaps = rdpcap('./attack1.pcap')
#print pcaps
ip_src=[]
ip_dst=[]
timestamp = []
data = []
def inet_to_str(inet):
    try:
        return socket.inet_ntop(socket.AF_INET,inet)
    except:
        return False
with open('attack1.pcap','rb') as f:
    pcap = dpkt.pcap.Reader(f)
    for ts,buf in pcap:
        eth = dpkt.ethernet.Ethernet(buf)
        if eth.type != dpkt.ethernet.ETH_TYPE_IP:
            continue
        ip_src.append(inet_to_str(eth.data.src))
        ip_dst.append(inet_to_str(eth.data.dst))
        d=datetime.datetime.fromtimestamp(ts)
        timestamp.append(d.strftime("%Y-%m-%d %H:%M:%S.%f"))
        data.append(eth.data.data.data)
    dataframe = pd.DataFrame({"ip_src":ip_src,"ip_dst":ip_dst,"timestamp":timestamp,"data":data})
    dataframe.to_csv("test.csv",index=False,sep=',')
